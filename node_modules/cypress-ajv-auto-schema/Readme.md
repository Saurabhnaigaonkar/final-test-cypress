
---

# 📦 cypress-ajv-auto-schema

> 🚀 Cypress plugin to **auto-generate** and **validate** JSON Schemas from API responses using [AJV](https://ajv.js.org/) and [cypress-ajv-schema-validator](https://www.npmjs.com/package/cypress-schema-validator).
> Perfect for **contract testing** and keeping your API responses in sync.

---

## ✨ Features

* 🔹 Auto-generate JSON Schema files directly from API responses
* 🔹 Validate API responses against saved schemas (AJV-powered)
* 🔹 One command to **check** (generate-if-missing, validate-if-present)
* 🔹 Works with both **JavaScript** and **TypeScript** Cypress projects
* 🔹 Stores schemas under `cypress/fixtures/schemas/` by default

---

## 📥 Installation

```bash
# install plugin + peer dependencies
npm install --save-dev cypress-ajv-auto-schema cypress-ajv-schema-validator
```

---

## ⚙️ Setup

### 1. Register plugin in `cypress.config.js`

```js
const schemaPlugin = require('cypress-ajv-auto-schema');

module.exports = {
  e2e: {
    setupNodeEvents(on, config) {
      schemaPlugin(on, config);
      return config;
    },
    baseUrl: 'https://jsonplaceholder.typicode.com' // example API
  }
};
```

---

### 2. Load Cypress commands in `cypress/support/e2e.js`

```js
import 'cypress-ajv-auto-schema';
```

Now you can use `cy.apiSchemaGenerate`, `cy.apiSchemaValidate`, and `cy.apiSchemaCheck`.

---

## 🚀 Usage

### 🔹 Generate schema from API response

```js
cy.apiSchemaGenerate('/users/1', 'user');
```

👉 Creates `cypress/fixtures/schemas/user.json`.

---

### 🔹 Validate response against existing schema

```js
cy.apiSchemaValidate('/users/1', 'user');
```

---

### 🔹 Generate if missing, else validate

```js
cy.apiSchemaCheck('/users/1', 'user');
```

---

### 🔹 Force schema update

```js
cy.apiSchemaCheck('/users/1', 'user', { update: true });
```

---

## 📂 Generated Schema Example

```json
{
  "title": "user",
  "type": "object",
  "properties": {
    "id": { "type": "number" },
    "name": { "type": "string" },
    "username": { "type": "string" },
    "email": { "type": "string" }
  },
  "required": ["id", "name", "username", "email"]
}
```

---

## ⚡ Commands API

### `cy.apiSchemaGenerate(url, schemaName, requestOptions?)`

* Sends request, generates schema, saves to fixtures.
* Returns `{ filePath, schema }`.

### `cy.apiSchemaValidate(url, schemaName, requestOptions?)`

* Loads schema from fixtures.
* Validates response using `cy.validateSchema` (from `cypress-schema-validator`).

### `cy.apiSchemaCheck(url, schemaName, { update = false, requestOptions = {} })`

* If schema missing → generate.
* If schema exists → validate.
* If `update: true` → regenerate schema and overwrite.

---

## ⚙️ Options

* **Schemas directory**: defaults to `cypress/fixtures/schemas`.
  Override via `env` in `cypress.config.js`:

  ```js
  env: { cjsSchemasDir: "cypress/contracts" }
  ```

---

## 🛠 Development

Link locally for testing:

```bash
# inside plugin repo
npm link

# inside your Cypress project
npm link cypress-ajv-auto-schema
```

Or use a local tarball:

```bash
npm pack
npm install ../cypress-ajv-auto-schema-1.0.0.tgz
npm install -D cypress-ajv-schema-validator
```
---
## Compatibility
    Cypress 12.0.0 or higher
    Ajv 8.16.0 or higher
    ajv-formats 3.0.1 or higher
---

## 📜 License

[MIT](LICENSE) © 2025 \[Saurabh Naigaonkar]

---




